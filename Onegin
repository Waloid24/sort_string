#include <stdio.h>
#include <stdlib.h>
#include <string.h>

size_t my_getline (char** dest_adr, int * size, FILE * stream);
void sort_strings (char * mass_of_pointer_to_strings[], int counter);
void print_array_in_file (char ** array, int number_of_strings, FILE * ptr_output_file);
int read_file (char ** buffer_1, FILE ** ptr_output_file_1);

const int STANDART_SIZE = 10;
// header file 
int main (void)
{	
	char * buffer = nullptr;
	FILE * ptr_output_file = nullptr;
	int number_of_successfully_read_elements_fread = read_file (&buffer, &ptr_output_file);
	
	printf("buffer = %p after function\n", buffer);
	printf("ptr_output_file = %p after function\n", ptr_output_file);
	
	// end of reading function
	
	long int number_of_strings = 1;
	
	for (int i = 0; i < number_of_successfully_read_elements_fread; i++)
	{
		if (buffer[i] == '\n')
		{
			buffer[i] = '\0';
			number_of_strings++;
		}	
	}
	//split into lines
	char ** mass = (char **) calloc (number_of_strings, sizeof(char *));
	*mass = &(buffer[0]);
	mass++;	
	
	for (int i = 0, j = 1; i < number_of_successfully_read_elements_fread, j < number_of_strings; i++)
	{
		if (buffer[i] == '\0')
		{
			*mass = &(buffer[i+1]);
			mass++;
			j++;
		}
	}
	mass = mass - number_of_strings;	
	
	sort_strings (mass, number_of_strings);
	
	print_array_in_file (mass, number_of_strings, ptr_output_file);

	free (buffer);
	
	return 0;	
}

void sort_strings (char * mass_of_pointer_to_strings[], int counter)
{
	char * temp = nullptr;
	for (int i = 0; i < counter - 1; i++)
		for (int j = i + 1; j < counter; j++)
			if (strcmp(mass_of_pointer_to_strings[i], mass_of_pointer_to_strings[j]) > 0)
			{
				temp = mass_of_pointer_to_strings[i];
				mass_of_pointer_to_strings[i] = mass_of_pointer_to_strings[j];
				mass_of_pointer_to_strings[j] = temp;
			}
}

void print_array_in_file (char ** array, int number_of_strings, FILE * ptr_output_file)
{
	for (int i = 0; i < number_of_strings; i++)
	{
		fputs (*array, ptr_output_file);
		array++;
	}
}

int read_file (char ** buffer_1, FILE ** ptr_output_file_1)
{
	FILE * ptr_file = fopen ("Hamlet.txt", "rb");
	*ptr_output_file_1 = fopen ("Output.txt", "wb");
		
	if (ptr_file == NULL)
	{
		printf("Reading file \"Hamlet.txt\" error.\n");
		return -1;
	}
	if (*ptr_output_file_1 == NULL)
	{
		printf("Reading file \"Output.txt\" error.\n");
		return -3;
	}
	
	fseek (ptr_file, 0, SEEK_END);
	long int size_of_file_in_bytes = ftell (ptr_file); 
	fseek (ptr_file, 0, SEEK_SET);
	long int number_of_elements = size_of_file_in_bytes / (sizeof(char));
	
	*buffer_1 = (char *) calloc (number_of_elements + 1, sizeof(char));
	
	if (*buffer_1 == NULL)
	{
		printf("It is impossible to allocate memory for a file.\n");
		exit(1);
	}
	
	size_t number_of_successfully_read_elements_fread = fread (*buffer_1, sizeof(char), number_of_elements, ptr_file);
	(*buffer_1)[number_of_elements] = '\0';
	
	if (number_of_successfully_read_elements_fread != number_of_elements)
	{
		printf("Reading error.\n");
		exit(2);
	}
	
	return number_of_successfully_read_elements_fread;
}
